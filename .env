# Abracadabra Server Environment Configuration
# Copy this file to .env and customize the values for your deployment

# =============================================================================
# Server Configuration
# =============================================================================

# Port where the server will listen
ABRACADABRA_PORT=8787

# External port mapping for Docker (maps to container port 8787)
HTTP_PORT=80
HTTPS_PORT=443

# Host interface to bind to (0.0.0.0 for all interfaces)
ABRACADABRA_HOST=0.0.0.0

# Environment mode (development, production)
DENO_ENV=production

# =============================================================================
# Security Configuration
# =============================================================================

# JWT secret key for session tokens (CHANGE THIS IN PRODUCTION!)
# Generate a secure random string: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-make-it-long-and-random

# Session timeout in seconds (default: 30 days)
SESSION_TIMEOUT=2592000

# CORS allowed origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:5173,https://your-frontend-domain.com

# =============================================================================
# Database Configuration
# =============================================================================

# Path to Deno KV database file inside container
DENO_KV_PATH=/app/data/kv/abracadabra.db

# Local path for KV data persistence
KV_DATA_PATH=./data/kv

# Backup configuration
BACKUP_INTERVAL=3600
BACKUP_RETENTION_DAYS=7
BACKUP_DATA_PATH=./data/backups

# =============================================================================
# File Upload Configuration
# =============================================================================

# Maximum file size in bytes (default: 10MB)
MAX_FILE_SIZE=10485760

# Upload storage path inside container
ABRACADABRA_UPLOAD_PATH=/app/uploads

# Local path for upload data persistence
UPLOAD_DATA_PATH=./data/uploads

# Use S3 for file storage (true/false)
USE_S3=false

# S3 Configuration (only needed if USE_S3=true)
S3_BUCKET=your-bucket-name
S3_REGION=us-west-2
S3_ACCESS_KEY_ID=your-access-key-id
S3_SECRET_ACCESS_KEY=your-secret-access-key

# =============================================================================
# Document Configuration
# =============================================================================

# Maximum nesting depth for hierarchical documents
MAX_NESTING_DEPTH=10

# Maximum document size in bytes (default: 5MB)
MAX_DOCUMENT_SIZE=5242880

# Maximum collaborators per document
MAX_COLLABORATORS=50

# =============================================================================
# Real-time Collaboration Configuration
# =============================================================================

# Hocuspocus WebSocket port
HOCUSPOCUS_PORT=1234

# WebSocket connection timeout in milliseconds
WEBSOCKET_TIMEOUT=30000

# =============================================================================
# Server-Side Scripting Configuration
# =============================================================================

# Script execution timeout in milliseconds
SCRIPT_TIMEOUT=30000

# Allowed domains for fetch() in scripts (comma-separated)
ALLOWED_DOMAINS=api.github.com,httpbin.org,jsonplaceholder.typicode.com

# =============================================================================
# Logging Configuration
# =============================================================================

# Log level (DEBUG, INFO, WARN, ERROR)
LOG_LEVEL=INFO

# Local path for log data persistence
LOG_DATA_PATH=./data/logs

# =============================================================================
# Monitoring Configuration (Optional)
# =============================================================================

# Prometheus monitoring port (only used with monitoring profile)
PROMETHEUS_PORT=9090

# =============================================================================
# Development Configuration
# =============================================================================

# For development, you might want to override some settings
# Uncomment and modify as needed:

# DEV_ABRACADABRA_PORT=8787
# DEV_LOG_LEVEL=DEBUG
# DEV_CORS_ORIGINS=http://localhost:3000,http://localhost:5173
# DEV_SESSION_TIMEOUT=86400

# =============================================================================
# Production Deployment Notes
# =============================================================================

# 1. Change JWT_SECRET to a secure random value
# 2. Set appropriate CORS_ORIGINS for your frontend domains
# 3. Configure S3 settings if using cloud storage
# 4. Set LOG_LEVEL to INFO or WARN in production
# 5. Ensure data directories have proper permissions
# 6. Use HTTPS in production with proper SSL certificates
# 7. Consider setting up monitoring and backup strategies
# 8. Review and adjust file size and document limits based on your needs

# =============================================================================
# Quick Start Commands
# =============================================================================

# Development:
# docker-compose up -d

# Production with proxy:
# docker-compose --profile production up -d

# With monitoring:
# docker-compose --profile monitoring up -d

# View logs:
# docker-compose logs -f abracadabra-app

# Backup database manually:
# docker-compose exec kv-backup cp /app/data/kv/abracadabra.db /app/data/backups/manual_backup_$(date +%Y%m%d_%H%M%S).db
